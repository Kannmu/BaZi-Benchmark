# BaZiBench 研究发现

**创建时间**: 2026-02-17

---

## 八字计算核心规则

## 当前实现进展（2026-02-18）

- 已完成 `bazibench/core` 六大核心模块：`constants.py`、`calculator.py`、`wuxing.py`、`ten_gods.py`、`strength.py`、`interactions.py`
- 已补齐 `bazibench/__init__.py` 与 `bazibench/core/__init__.py` 导出接口
- 已新增测试用例：`tests/test_constants.py`、`test_calculator.py`、`test_wuxing.py`、`test_ten_gods.py`、`test_strength.py`、`test_interactions.py`
- 为 pytest 增加 `tests/conftest.py`，确保包导入路径可用
- 用户在本地环境运行 `pytest` 全部通过


### 1. 天干地支基础

**十天干**:
- 阳干: 甲、丙、戊、庚、壬
- 阴干: 乙、丁、己、辛、癸

**五行对应**:
| 天干 | 五行 | 阴阳 |
|------|------|------|
| 甲 | 木 | 阳 |
| 乙 | 木 | 阴 |
| 丙 | 火 | 阳 |
| 丁 | 火 | 阴 |
| 戊 | 土 | 阳 |
| 己 | 土 | 阴 |
| 庚 | 金 | 阳 |
| 辛 | 金 | 阴 |
| 壬 | 水 | 阳 |
| 癸 | 水 | 阴 |

**十二地支**:
| 地支 | 五行 | 生肖 | 藏干 |
|------|------|------|------|
| 子 | 水 | 鼠 | 癸 |
| 丑 | 土 | 牛 | 己癸辛 |
| 寅 | 木 | 虎 | 甲丙戊 |
| 卯 | 木 | 兔 | 乙 |
| 辰 | 土 | 龙 | 戊乙癸 |
| 巳 | 火 | 蛇 | 丙庚戊 |
| 午 | 火 | 马 | 丁己 |
| 未 | 土 | 羊 | 己丁乙 |
| 申 | 金 | 猴 | 庚壬戊 |
| 酉 | 金 | 鸡 | 辛 |
| 戌 | 土 | 狗 | 戊辛丁 |
| 亥 | 水 | 猪 | 壬甲 |

### 2. 五行生克

**相生**: 木→火→土→金→水→木
**相克**: 木→土→水→火→金→木

### 3. 四柱计算规则

**年柱**:
- 以立春为界（约2月4日）
- 公式: 年干 = (年份 - 3) % 10, 年支 = (年份 - 3) % 12

**月柱**:
- 月支固定: 正月寅、二月卯...
- 月干由年干决定（五虎遁口诀）

**五虎遁**:
```
甲己之年丙作首 → 甲/己年正月起丙寅
乙庚之岁戊为头 → 乙/庚年正月起戊寅
丙辛必定寻庚起 → 丙/辛年正月起庚寅
丁壬壬位顺行流 → 丁/壬年正月起壬寅
戊癸何方发，甲寅之上好追求 → 戊/癸年正月起甲寅
```

**日柱**:
- 需要基准日期计算
- 基准: 1900年1月31日为甲子日

**时柱**:
- 时支: 23-1子时, 1-3丑时...
- 时干由日干决定（五鼠遁口诀）

**五鼠遁**:
```
甲己还加甲 → 甲/己日子时起甲子
乙庚丙作初 → 乙/庚日子时起丙子
丙辛从戊起 → 丙/辛日子时起戊子
丁壬庚子居 → 丁/壬日子时起庚子
戊癸何方发，壬子是真途 → 戊/癸日子时起壬子
```

### 4. 十神计算规则

以日主为中心，根据五行关系和阴阳判断:

| 关系 | 同阴阳 | 异阴阳 |
|------|--------|--------|
| 同我(同五行) | 比肩 | 劫财 |
| 生我 | 偏印 | 正印 |
| 我生 | 食神 | 伤官 |
| 我克 | 偏财 | 正财 |
| 克我 | 七杀 | 正官 |

### 5. 日主强弱判断

**得令**: 日主生于当令月份
- 木日主: 寅卯月得令
- 火日主: 巳午月得令
- 金日主: 申酉月得令
- 水日主: 亥子月得令

**得地**: 地支有根
- 查看四柱地支藏干
- 本气 > 中气 > 余气

**得势**: 天干有比劫帮扶

### 6. 刑冲合害

**六合**: 子丑合土、寅亥合木、卯戌合火、辰酉合金、巳申合水、午未合土

**六冲**: 子午冲、丑未冲、寅申冲、卯酉冲、辰戌冲、巳亥冲

**三合**:
- 申子辰合水局
- 寅午戌合火局
- 巳酉丑合金局
- 亥卯未合木局

**相刑**:
- 子卯刑（无礼之刑）
- 寅巳申刑（无恩之刑）
- 丑戌未刑（恃势之刑）
- 辰午酉亥自刑

---

## 现有库调研

### Python八字计算库

1. **sxtwl** - 简单八字计算库
2. **lunarcalendar** - 农历转换
3. **cnlunar** - 中国农历和八字

**决策**: 自己实现核心计算，确保可控性和准确性验证

---

## API设计考量

### 模型接口设计

需要支持:
- OpenAI API (GPT系列)
- Anthropic API (Claude系列)
- 自定义BaseURL (DeepSeek, Qwen等)
- 本地模型 (通过OpenAI兼容接口)

### 配置格式

```yaml
models:
  - name: "gpt-4o"
    provider: "openai"
    api_key: "${OPENAI_API_KEY}"

  - name: "deepseek-v3"
    provider: "openai_compatible"
    base_url: "https://api.deepseek.com/v1"
    api_key: "${DEEPSEEK_API_KEY}"
```

---

## 测试数据设计

### 评估维度

1. 基础排盘 (15%)
2. 五行分析 (15%)
3. 日主强弱 (20%)
4. 十神分析 (15%)
5. 用神选取 (15%)
6. 刑冲合害 (10%)
7. 大运流年 (5%)
8. 综合解读 (5%)

### 难度分布

- 难度2 (基础): 30%
- 难度3 (中等): 35%
- 难度4 (较难): 25%
- 难度5 (困难): 10%
